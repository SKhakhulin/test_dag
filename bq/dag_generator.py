from airflow import DAG
from datetime import datetime, timedelta

from airflow.contrib.hooks.bigquery_hook import BigQueryHook

from airflow.operators.python_operator import PythonOperator
from airflow.contrib.operators.bigquery_operator import BigQueryOperator

carriers = ['000001_vpnking', '000001_vpnkingprivate', '000001_vpnkingproxy', '0000_1KSAVPN', '0000_1UAEVPN', '0000_QUATARVPN1', '0000_Standard', '0000_VPNUSA1', '0000_genesisvpn', '0000_myvpn', '0000_test_public_vpn', '0000_vpn123', '000_ElegantVpn', '000_freeturbo', '000_freevpnappandroid1', '000_testvp', '000_turbo', '001_54000_publicvpn', '001_Super01', '001_alphavpn', '001_jeevan', '001_mevpn', '001_supervpn', '001_testvpnme', '001_vpntrue', '002_en_new_vpn_app', '003955_ultimatevpn', '005_in4ti_freevpn', '007_Canada', '007_amazing_proxy', '007_huawei', '007_myvpn', '007_vpnTry2', '0088_66985', '0093_MasterVpn', '00962_6898anos', '010576_smartvpnfreeservers', '012011_hot_vpn', '01234_1446621333', '01234_2323423444', '012_786110', '012_cellvpn', '01_UltimatefreeVpn', '01_dotfreevpn', '01_freeforallvpn', '01_ghostvpn', '01_hotvpn', '01_indo_vpn', '01_testvpn', '01_vpnapp', '021577_gom_vpn', '021577_gomvpn', '021_Solid_vpn', '021_dovevpn', '021_indiavpn', '0237_supervpn', '029_001ais', '02_commainulmyvpn', '0300_arcovpn', '0300_triggervpn', '0300_virtual', '0305_VPNFAST1', '0305_aqibvpn', '0305_fastvpn', '0305_flexivpn1', '0305_free_vpn', '0305_provpn', '0305_salma', '0305_vishwakarma', '0340_gravon', '0345_gecko', '0358_assiavpn', '0369_bestsecure', '0369_pabloprotection', '039_BbrandVpn', '039_FutureZone', '039_NaughtyApps', '041115_bestvpn', '051_Best_Secure_VPN', '051_octopus_shs', '051_raccoon', '051_super_vpn', '06370_new_vpn', '07_774444', '0808_44708702', '0809_vpnfree', '089001_bluevpn2', '0903_rabbit', '0903_snake', '090903_uvpnapp', '0909_vpn_game', '099_ahavpn', '099_money', '0_47356', '0_768b37f9e53b2', '0_784501', '0_XtremVPN', '0_test_id', '0_testing_for_vpn', '1', '1000_money', '1001_Drvpn', '101_darkvpn', '10530_boltvpn', '109409_wingsvpns', '10_lordvpn', '11011_smnfirst', '1102_easyvpn', '11111_DEMO123', '111222_libravpn', '111983_cosmovpn', '111_FigLeaf', '111_allcar360', '111_vpn_express', '112233_supervpn', '1122_fastvpn', '1122_mint_vpn', '1122_orangevpn', '1124_vpnsatelite', '114568_78787878', '114_android', '11_freevpnserver', '12069_YourVPN', '1206_speed_proxy', '1206_speedvpn', '1206_uturn', '1210_syzigo_new', '121144_appspedia', '12121_ghost', '1212_ahead', '1212_bdvpn', '1212_demotest', '1212_idemo', '1212_totovpn', '1212_turkey', '1212_uploadtotovpn', '1212_xiaofeiji', '1212_zedvpn', '1214_doublevpn', '121_new_id_for_vpn', '12235_vpnturbo', '1223_19921', '123123_geekVpn', '1232_ngawur', '1233_melonvpn', '12345', '12345678', '123456_1234567', '123456_345555', '123456_77777', '123456_CurrentVPN', '123456_SaleStarxPowerxVPN', '123456_SpeedVPN', '123456_VPN_Unblock', '123456_VpnPro', '123456_VpnTest1', '123456_Vpntastic', '123456_crystalvpn', '123456_fastvpn', '123456_flipvpn', '123456_freesupervpn', '123456_mdrasel', '123456_my_vpn', '123456_onvpn', '123456_ravenapp_vpn', '123456_smart_free_VPN', '123456_supervpn', '123456_tempvpn', '123456_testproject', '123456_testvpn', '123456_touchvpn', '123456_ultimatevpn', '123456_vpn_business_pkc', '123456_vpn_pro', '123456_vpn_unlimitted', '123456_vpnme', '123456_vpntest', '123456_vpnunblockmaster', '12345_pavpn', '12345_proxy_vpn', '1234_21212121', '1234_7777777', '1234_88888888', '1234_Android3', '1234_QatarVPN', '1234_android', '1234_moevpn', '1234_myvpn', '1234_public_vpn', '1234_testing', '1234_testproject', '1234_vpn01', '1234_vpn_app_itech', '1234_vpnboost', '1234_vpnboss', '1234_wolfbrowserr', '1234_zico2', '12354_pelican_new', '123555_freevpn', '123_123456', '123_AmazaVpn', '123_DotVpn', '123_Free_VPN', '123_Hot_VPN', '123_Hotvpn', '123_ReformVPN', '123_Testing_bangla', '123_VPNFreeaad', '123_VPN_FREE', '123_VPN_for_pubg', '123_VPNapp', '123_af045', '123_demo123', '123_expressvvn', '123_indiavpn', '123_indservice', '123_justvpn', '123_p12345678', '123_pak_pubg', '123_pro_vpn', '123_qwerty1234321', '123_sssss', '123_super_fast_vpn', '123_super_vpn', '123_supervpn', '123_tiktoka', '123_usa_vpn', '123_vpn_master', '123_vpn_vpn', '123_vpnproxy', '123_vpnpubg308', '123_world', '125687_evpnmaster', '1268_1268_00', '1268_756900', '127309_ultragripvpn', '1298_vpnfree', '12_gamavpn', '12_omegavpn', '12_portal', '130586_Highspeedvpn', '133649_133649', '1337_vpnoid', '1350_Elitevpnfree', '1350_bestvpn', '135181_Radar', '135181_meraandroid', '148492_newvpn', '150122_supervpn', '15150_zvpnfree', '152123_vpnapp', '1522_Super', '15246_9258070', '1528_geeksvpn', '153_vpn_vante', '154125_ozityvpn', '1556_strong', '161683_bami1', '1650_00001', '1650_test66', '16owiq_india', '16owiq_vpnexpress', '181225_vpn_for_empflix_browser', '181225_vpn_for_gaycock4u_browser', '181225_vpn_for_gaytube_browser', '181225_vpn_for_habr_browser', '181225_vpn_for_pornhub_browser', '181225_vpn_for_reddit_browser', '181225_vpn_for_redtube_browser', '181225_vpn_for_sleazyneasy_browser', '181225_vpn_for_spankbang_browser', '181225_vpn_for_tnaflix_browser', '181225_vpn_for_tube8_browser', '181225_vpn_for_xhamster_browser', '181225_vpn_for_xnxx_browser', '181225_vpn_for_xvideos_browser', '181225_vpn_for_youjizz_browser', '181225_vpn_for_youporn_browser', '181225_vpn_for_youtube_browser', '190065_arfastvpn', '1903_454564546', '1903_freeproxy', '1903_master', '1922_superbiivpnxnx', '1982_alphavpn', '1982_mevpn', '1986_DarkVpn', '1986_unblockwebsites', '19877_mktarvpn', '1987_BlackHoleVPN', '1987_blackhole', '1987_gmgvpn', '1988_ecovpnpro', '1988_one_click_vpn_pro', '1990_first1', '1990_first2', '1990_studioninja', '1991_vpnAlarm', '1992_IRAN99', '1992_KSA44', '1992_QATAR56', '1992_UAE12', '1992_sivpn4', '1995_19951130', '1_190536', '1_Achty', '1_Kishan_Godhani_VPN', '1_azuravpn1', '1_balaghatvpn', '1_bestfreevpn', '1_devpn', '1_fav_vpn', '1_freevpn', '1_hizlivpnpro', '1_idvpn', '1_kmavpn', '1_litevpn', '1_netflo1122', '1_pubgfreevpn', '1_public_vpn', '1_public_vpn_2', '1_public_vpn_3', '1_publicvpn1122', '1_tarvpn', '1_uuuuuuuu', '1_vipvpn', '1_vpn2020', '1_vpnapp', '1ndjjd_chdvhsk', '2011_1pkRWig4', '202017_prosharvpn', '2020_hidemaxfreevpn', '2020_securemaxvpn', '2020_vpnbox', '2020_vpncat', '2020_vpncow', '2020_vpndog', '2020_vpnowl', '2020_vpnpro', '2020_vpnspacehowen', '20584_tech4webde', '205_UltraVPN', '20938_govpn', '21000_GetVPN', '21001_vpn_fred', '213_MovieRulzVPN', '2141mz_GratisVPN', '21621_trustvpn', '21_magic', '21_octovpn', '21_secure', '21_space', '21_super', '220189_vpnsuper', '221183_ciro2020', '221183_pitbull', '2211_00112', '2211_Floren', '2211_Netflo', '222300_magicvpn', '222567_TeaVpn', '224466_UltimateVPN', '2254_superfastvpn', '230788_123456', '234_dual_browser', '234_tokoto', '23_202020', '23_pub123', '245847_uptimevpnpro', '245867_OromoVPN', '24_bestvpnfreeunlimited', '24_oliveVPN_Pro_New', '24_olivevpnpro', '2524_publicvpn', '261295_superfreevpn', '2636_000001', '2636_free_pv', '27374_27374', '280451_cloudfreevpn', '28100_free_vp', '2818_KentoosVpn', '2818_SentotVpn', '2828_KongVPN', '29374_eagleeyevpn', '29979_Snowvpn', '300162_PublicVPN', '30100_pimburavpn', '301301_rocketvpn', '302012_supremevpn', '302020_lionvp', '3131_cybervpn', '3131_ngsvpn', '313_SimpliVPN', '31415_31415', '31415_31415926', '3214_SwitchVpnPro', '321_321bi', '321_fast_vpn', '321_imtyvpn', '33100_foxvpn', '3310_FastVpn', '3310_halaVPN', '331997_vpnnew', '332211_super_nd_ultimate_vpn', '333_bossvpn', '333_bossvpnnn', '333_bossvvpn', '333_testvpnn', '33400_mysplixvpn', '33400_vpnkilat', '334221_testing_project', '33500_quick', '335312_878877', '34000_fastest', '34000_trendvpn', '3400_FSTVPN00', '3403_123456', '3421_rapidvpn', '34220_11542', '34320_geovpn', '354_testo', '355_gamervpn', '355_pkvpn', '3562_aiva_vpn', '37_speedvpn37', '37_supervpn37', '382715_382715', '382715_635108', '382715_903341', '383471_octopusvpn', '3_quantum', '4', '400011_afternamevpn', '400011_canadavpnapp', '400011_germanyvpnapp', '400011_indiavpnapp', '400011_japanvpnapp', '400011_premiumvpnapp', '400011_r8ablueindiavpn', '400011_russiavpnapp', '400011_usavpnapp', '400011_vpnappfb', '400072_super', '410206_goldvpn', '410206_truevpn', '412123_3333VPN', '412123_8888vpn', '412123_XX1VPN', '412123_acevpn', '412123_anonyvpn', '412123_armadavpn', '412123_bokapvpn', '412123_boltvpn', '412123_colorvpn', '412123_duckvpn', '412123_expressfaster', '412123_expressprivate', '412123_expressturbo', '412123_greenvpn', '412123_jajangvpn', '412123_kiwivpn', '412123_krisnavpn', '412123_strangevpn', '412123_superbvpn', '412123_univpn', '412123_upxvpn', '412123_vpnexpress', '412123_vpnxxx', '412123_xxxvpn', '41_perfectvpn', '41_perfectvpnn', '421_yourcompany', '42_safari_vpn', '434335_firevpn', '434335_freev', '434335_multivpn', '434335_secret', '434335_svpn17', '434335_vpnone', '434335_vpnpoint', '4347_vpn_guard', '440034_privacyvpn', '44162_mobivpn', '4452_4452_vpnpras', '4452_4chanVPN', '4500_freevpn', '453441_indivpn', '45454_demoapp', '45_myvpn', '46000_123Shvpn', '4620_apexvpn', '4620_ezeevpn', '46300_speedvpnn', '4848_482343', '48_fastvpnpro', '5', '50000_freevpn', '50000_siphon', '500_ninja', '51214_11072', '531696_vpnandroid', '53261_september01', '53261_september02', '54000_UtimateFreeVpn', '54000_phanteravpn', '54000_vpnff', '54000_vpnmaster', '54000_vpntest', '542135_AbVpn', '542135_geo23vpn', '54252_My_vpn_pro', '54252_Premium', '5428_VPN_5428', '5428_Vpn_extreme', '5497_VPN20', '5555_VPN_BOTTLE', '555_MagicVpn', '5580_hotster', '5580_vpnapp', '55_Truva_VPN', '55_navegador', '566266_muffinvpn', '5707_foxbit', '5707_orange_vpn', '574589_vpnandroid', '59161_bor1cua1', '59161_foreveryone', '59161_secure', '59161_weivpn', '59930_tesla', '5_45456', '6', '6060_123vpn', '610041_20180918', '610041_20190612', '619_gesitvpn', '625532_7788_speed', '62_VPN_PROJECT', '62_ulokadud', '635108_63510', '63510_81640', '63_limitless', '63_pramodvpn', '63_proxy', '64000_smartvpnpro', '65020_zeonvpn', '654321_vpn77', '65_appumob', '663131_vpnmaster', '6646_Jao_VPN1', '666_00001', '669947_122112', '669947_364094', '679562_gameserver', '681123_vpnGate', '6898_123456789', '6898_Anas99', '6898_supper', '6898_vpnnew', '69_vpndeluxe', '6_12345', '701730_Tahaluf', '7124_UnlimitedSpeedVPN', '7193_hydravpwn', '7200_supervpn7200', '725_vpnserver', '73476_com_kinectpro_testVPN', '741151_nimble', '741151_testvpn', '7495_tigervpn', '754_SmartVpn', '7569_1268_111', '76120_112233', '777_GoodToolsLab_SuperVPN', '786454_xxvpn', '786_00000001', '786_1100000011', '786_33801890', '786_GlobalVPN', '786_R0w9E7E8JB', '786_avdHD', '786_canada', '786_crispy_free_vpn', '786_ertugul', '786_france', '786_freeVPN', '786_germany', '786_ghost', '786_hotspot_shield', '786_japan', '786_netflix', '786_opera', '786_pubgvpn', '786_super_vpn', '786_switzerland', '786_thanos', '786_uaevpn', '786_usavpn', '786_vpn123', '7877_ultimatevpn', '7888_159778995225', '7890_78900', '804408_appsstudio15', '804408_highpower', '8045_vpnmaster', '8080_webhuntvpn', '8200_mmsupervpn', '8447_Winvpn_01', '846009_ExpressVPN', '846009_Rohinivpn', '84700_134556', '854712_israel2020', '854712_myapps', '854712_ukvpn2020', '854712_vpnworld', '85593_85593', '880880_880880', '8821_52145', '8821_anti_vpn', '8821_privet_vpn', '8821_vpn_test', '886756_playvpn', '888_UmbrellaVPN', '888_xxxvpn', '88_ar_pure_vpn', '88_speedvpn', '9012_mangovpnpro', '903341_635108', '903341_66931', '903341_903341', '903341_909951', '903341_samurai', '903341_zerovpn', '9040_abc_vpnproxymaster', '9040_vpnxyz', '9090_VPNWin', '9090_VPN_1', '90_secure_vpn_pro', '90_sunvpn', '91200_vpn_for_pubg', '91_1111111111111', '91_54000', '91_8112948817', '91_OneTouchVpn', '91_VPN_CONNECT', '91_classicvpn', '91_homevpn', '91_linishavpn', '91_maskvpn', '91_mivpn', '91_mkvpnpubg', '91_newindia', '91_rapidvpnpro', '91_teral', '91_vpn_con', '923_11111', '923_hydravpnrwp', '92_12345', '92_eyesvpn', '92_ghungroo', '92_hamzavpn', '92_keyvpn', '92_lionp', '92_omgvpn', '92_rushvpn', '92_smartovpn', '92_vpnMaster', '92_vpntesting', '9344_Securevpn', '94086_23111993', '9443_mastervpn_lite', '9569_manager', '95_64342', '95_carryvpn', '95_spider9500', '95_spidervpn130', '95_the_spider_net', '95_vpncarry', '95_vpnjelly', '972_Wizardvpn', '9810_wild_vpn', '9810_wild_vpn_latest', '98765_74904', '9876_9087650', '9928_VpnSuperBuddy', '9928_vpnonline', '996_SnapVPN', '996_raccoon', '999999_FreeUnlimitedVPN', 'AF-01', 'Ahdeva_vpn1453', 'Akhtar_Swiftvpn', 'Ali_happyvpn', 'Ali_stonevpn', 'Ali_vpn_app', 'Aqib_vpnserver', 'Awesome_Vpn', 'Ayaz_fastvpn', 'BDPOT_SuperVPN', 'Baaj_2981982', 'Bhattarai_ask123', 'Breslin_BrezzzVPN', 'BujanganUrban_20258bokap_sugiono', 'BujanganUrban_Bohay', 'BujanganUrban_bokap22vpn', 'BujanganUrban_bokapperfect', 'Company_BikaVPN', 'Company_LordVPN', 'Creative_SafeVPN', 'DT_flyvpn', 'DT_ufovpn', 'Das_desivpn', 'DefiantApp_vpnpro', 'Develp_tomvpn', 'Dihan_dmvipvpn', 'Dini_vxsvpn', 'Dini_vxsvpn43', 'Doc_indbypass', 'Elafris_11122233', 'Encoders_supervpn', 'Ewooks_freevpn', 'Gorai_susanta', 'GuardNet_admin', 'Heropanti_PUBG_KA', 'Hossain_rexvpn', 'Hossain_saxvpn', 'Individual_123456', 'Iqbal_vpnapp', 'Javid_101010', 'Javid_202020', 'Javid_404040', 'Kahnwald_190334', 'Kaydev_12345', 'Khan_vpnapp', 'Kodesense_kode2', 'Kodesense_mabrar92', 'Kodesense_utlimatevpn', 'Kumar_jupitervpn', 'Kumar_jupitervpn2', 'Kumar_rushv', 'LKH_vpnpro', 'Lotub_ninja_vpn', 'MadrasHOT_whalewpn', 'Mendes_supervpn', 'Mr_vpntoto', 'Mughal_123456', 'MyVpn', 'Nicoletti_fittyvpn', 'Ninesol_project_vpn', 'Nirvana_tao_vpn', 'NonlineApps_gedavpn', 'Nurani_ultrasuper', 'OmniNet_2', 'OmniNet_3825', 'OmniNet_3962', 'OmniNet_4013', 'OmniNet_4275', 'OmniNet_4300', 'OmniNet_4320', 'OmniNet_4344', 'OmniNet_4436', 'OmniNet_4454', 'OmniNet_4455', 'OmniNet_4456', 'OmniNet_4457', 'OmniNet_4458', 'OmniNet_4459', 'OmniNet_4460', 'OmniNet_4529', 'OmniNet_4577', 'OmniNet_4626', 'OmniNet_4687', 'OmniNet_4770', 'OmniNet_Test', 'PikoStudio_Pikovpn', 'PikoVpn_Pikovpn', 'Pjdroidapp_Ultrasurf', 'PokeVPN_psvpn', 'Powzie_Herbs', 'Powzie_Travy', 'R64AxRmXrm', 'REIS_vpnapp', 'ROSHIYA_Roshiyavpn', 'Raindrops_KingPro', 'Revaliente_turbovpnfast', 'Sadar_vpnpublic', 'Sam_vxsvpnfire', 'Saqib_fireturbovpn', 'Satyam_GrowVPN', 'Security_Inc_Lookout_VPN', 'Security_Inc_VPN_Bharti', 'Security_Inc_zerovpn', 'Shah_swiftvpn', 'Sobuj_bis_svpn', 'Soft_TinyVPN', 'Spigot_vuzevpn', 'Student_ultimatefreevpn', 'THANH_47236543', 'Tekin_17161616vpn', 'TestVPN', 'Tolaj_codevpn', 'TouchVpn_asdsa23', 'TraditionalApps_onetouchvpnfree', 'TurboVPN', 'Turfly_swift', 'TwinbitVPN', 'Uk_3dots', 'VK_dinvpn', 'VK_fastvpn', 'VK_usavpn', 'VPN_teamx13vpn', 'VUIOP_vxsvpn', 'Variablr_stackvpn', 'WEarea', 'WIFIADEMO', 'Webrategy_vpngrand', 'Willypeng_vpnmaster', 'ZLTech_ZLTech', 'ZeekVpn_zeekvpns', 'Zeelink_extreme', 'aaaa_11223344', 'aaaa_123456', 'aaaaa', 'aarglobal_blackyvpn', 'abbn_pubg4_308', 'accesstube', 'ae_vpn_ali4', 'aeiou_dluxvpn', 'af_acronis', 'af_better', 'af_router_sdk_test', 'af_versa', 'af_zimperium', 'afdemo', 'afdemo_fstest', 'aft_ApiTest_845', 'aft_April3', 'aft_Test_China', 'aft_always_on', 'aft_april112', 'aft_april26', 'aft_attwifis', 'aft_cat_tests', 'aft_cmaster', 'aft_cmaster_lite', 'aft_comcast_test', 'aft_dec27', 'aft_decem4', 'aft_delete', 'aft_delete3', 'aft_delpr7', 'aft_demo2', 'aft_demo3', 'aft_demo4', 'aft_dreambuilders', 'aft_hss_selected', 'aft_iramay10', 'aft_july17', 'aft_july2dfgd', 'aft_mayira1', 'aft_mayira2', 'aft_mayira3', 'aft_mult_001', 'aft_new_project', 'aft_nov201', 'aft_novem9', 'aft_november19', 'aft_october9', 'aft_offices', 'aft_pilot', 'aft_private_1', 'aft_projectemail', 'aft_projectuserid', 'aft_readdle', 'aft_sagiwall', 'aft_tbs001', 'aft_telenetb', 'aft_telenor', 'aft_test_center', 'aft_testdelpr', 'aft_tony_0', 'aft_tony_1', 'aft_veepee', 'aft_versa1', 'aft_vpn_test', 'alamin_rafiislam', 'alamin_rakib', 'alamin_suchi', 'albroapps_app01', 'albroapps_vpn_siren_head', 'albroapps_vpnreborn', 'algo_magic', 'algo_privacy6', 'allot_telenor', 'alososs_alososs', 'alsi_2awXsdTn7', 'alsi_824Dgm3z8', 'alsi_85vRbMh7B', 'alsi_Bjc3c5AgX', 'alsi_BvRQevVVM', 'alsi_FhkccJEmP', 'alsi_GpTUJUAVC', 'alsi_HTNTmK4pN', 'alsi_KCcRAn5mz', 'alsi_KvbtHphKf', 'alsi_MXMkY6bQE', 'alsi_MzYmkeg9C', 'alsi_SF3cXh34F', 'alsi_TgwVJEma7', 'alsi_VYubW55mg', 'alsi_XGeCqKX9h', 'alsi_XnbZKgrXb', 'alsi_ZFBy3n7xr', 'alsi_ZJ2NhRWYw', 'alsi_bM2MC42ep', 'alsi_czXfbsXwd', 'alsi_dUmQ2d5uB', 'alsi_dashtest0421', 'alsi_democorp', 'alsi_errortest', 'alsi_fSumryMBh', 'alsi_hwWwQFuqY', 'alsi_networktest061001', 'alsi_networktest061002', 'alsi_networktest061003', 'alsi_networktest061101', 'alsi_project020', 'alsi_project030', 'alsi_projectuserdelete', 'alsi_projectuserdelete2', 'alsi_projectuserdelete5', 'alsi_rDSEgeR8x', 'alsi_rTH5Kyhpa', 'alsi_sBsTCYKcE', 'alsi_sample001', 'alsi_sample002', 'alsi_sbtest', 'alsi_support001', 'alsi_support002', 'alsi_test00000000001', 'alsi_test001', 'alsi_test002', 'alsi_test003', 'alsi_test200918', 'alsi_test_server_location', 'alsi_test_server_location2', 'alsi_test_server_location3', 'alsi_test_user_activation', 'alsi_testforpricateserver', 'alsi_tfsr8GvqW', 'alsi_uanmVGvk3', 'alsi_vpntest0502', 'alsi_vpntest050201', 'alsi_vxnhrfeMB', 'alsi_weznT3G4B', 'alsi_wrKf6SMnM', 'alsi_yXBKbKPuy', 'alsi_yttest', 'amigo_thorvpn', 'androidwebde_9471691223', 'androidwebde_9471697566', 'ap0956_ultimatevpn', 'ap_nitrovpn', 'aqwzsx_dolphin', 'aqwzsx_kingvpn', 'aqwzsx_kiwivpn', 'aqwzsx_melon', 'aqwzsx_psyphon', 'aqwzsx_puffin', 'aqwzsx_purevpn', 'aqwzsx_siphon', 'aqwzsx_testtest', 'aqwzsx_ufovpn', 'arysecodes_snappyvpn', 'arysecodes_snappyvpn1', 'as_vpn_ali2', 'as_vpn_ali3', 'assss_pubg1_308', 'at_vpnindonesia', 'ath_startfromzero', 'athso_maxvpn', 'athso_maxvpn2', 'aura_vpn_af', 'avocad_av_public', 'awinc_vpnmelonpro', 'axazaa_sdbdhbhc', 'axl_RedWhite', 'bcdhdc_nvfjfvnj', 'ben112_kingsproxy1122', 'benkk_23091997', 'betternet', 'bguard_vpn_system', 'bhatti_leopardsvpn', 'bitdefender', 'bizone', 'bizone_sm', 'blaze_unblocker', 'blaze_vpn_service', 'boltpr_89590', 'boooom_vpnester', 'bsszzz_hbhdchdc', 'buntu_Free_VPN', 'buntu_vpn12', 'buntyco_vpncyper', 'bycoms_22945', 'bycoms_suraksha2', 'c_vpn_master', 'cdhhcd_cbjdcbjdbc', 'cheetah', 'cirkle_main_project', 'coder_coder', 'com_Turbo_VPN', 'daka_PhoenixVPN', 'dashlane', 'davidsm_Secure_VPN', 'dchdcb_vpntik1', 'dd_1242346', 'dd_SuperVpn', 'demo12_iqwhe', 'demo_sharpyvpn', 'demo_vpnapp', 'dhapa_marryvpnpro', 'digit_digitexa', 'dnts_igouvpnultimate', 'dnts_vpnkualatech', 'dora_free_vpn', 'droid_vpn123', 'droid_vpntest', 'droidoc_ultimatevpn', 'drt_fast_vpn', 'drt_mvpnxx', 'drt_vpnxx', 'dvfv_cbdhcbhd', 'dz_freschor', 'eeppyy_epyvpn', 'ehh_brrjfrj', 'elafri_stealthnetvpn', 'elhad_vpnpro', 'fastvpn_frewop', 'fineclickapps_fastturbovpn', 'fiver_78884013', 'fiver_fiverClientApp', 'flores_howenvpn', 'flymedia_gabbar', 'flymedia_gabbarvpn', 'foobar_companyx', 'foundation_SecretVPNVPNMasterPRO', 'foundation_VPNFreeUnlimitedProxy', 'foundation_turbovpn', 'freefedora_fedoravpn', 'fusionvpn_vpnfusion', 'gd8455_arrowvpn', 'gor24_gorillavpn', 'group_fcbrowser', 'group_fcbrowserfreevpn', 'gvggvv_freevpn1', 'h712_duals', 'h712_kunci', 'h712_vpn212', 'hamaz_vpn123', 'harun_ctgvpn', 'harun_testapps', 'hdev_aavpn', 'hdpune_demoapp', 'helo_vpn123', 'herowifi', 'hsbxhsbx_pubg_vpn_ali1', 'hsjjss_camvpn1', 'hsnbsst_544eddffr4', 'hsnbsst_vpnizle', 'hss', 'hsskeyboard', 'hsslite', 'hsxhsz_jcbjcj', 'hxshbxhs_indo3', 'i_cant_code_ultimateVPN', 'iaag_yerlivpn', 'iliptam_963833', 'inc_EliteVpn', 'inoox2_MiyabiVPN', 'inoox2_mastervpn', 'inoox2_xnxvpn', 'iooo_koranvp3', 'itech_FreeVpnMaster', 'ivpn_projectvpn', 'javed_jangovpn', 'jcbjdd_korvpn1', 'jdv_vpn11', 'jhb_nmhvcc', 'jkiut_koranvpn2', 'joss12_jossstream', 'joss12_jossstream2', 'juiyaa_canvpn2', 'karan_vpnapp', 'kasperskylab', 'kdv_vpn_app', 'khan_unlimitedfreevpn1', 'khan_vpnmasterunlimitedfreevpn', 'khasologix_gattovpn', 'kodhub_guestvpn', 'krx_unlimitedvpn', 'ks_KamerVPN', 'ks_fastvpn', 'ktk_DemoApp', 'ktk_ultimate_Vpn', 'kurdrex_vpnkurd', 'kvasxbb_pubg3_308', 'kwc_mti', 'latmx_vpnla', 'latmx_worldvpn', 'latrachdata_VPNder', 'lionmobi', 'lionmobiproxy', 'liquidum', 'liytre_xxbcdhd', 'lnj_kd1fhfhfhf', 'lol_violyvpb', 'lp_BrowserVpn', 'lp_vpnpublic', 'lvvmob_super', 'lzptec_brokepmontok', 'lzptec_brokepvpn', 'lzptec_deden19', 'lzptec_xxnxx', 'mahar1_vpn_test', 'mahdi_vpnG12', 'marcus_rapidvpn', 'mcafee', 'mcafee_msc2', 'mcafee_sc_vzs', 'mcafee_vz', 'mdu_vpn778778', 'mobunc_alwaysfree', 'mobunc_athena', 'mobuyg_great_vpn', 'mostofi_mrvpn', 'mostofi_server', 'msa_dddrfvfr', 'msa_fastvpn', 'mtvp_19aya12', 'muffincodestudio_muffin', 'mx_clickme', 'mx_fastecvpn', 'mx_hindvpn', 'mx_runnervpn', 'nijer_nijerapp', 'nil_ripvpn', 'nissa_vipervpn', 'nithin_cloudexvpn', 'no_556942d25ddsdf', 'no_VpnTester', 'no_menamo20200', 'nocode_superirovpnn', 'nomad_nomadvpn', 'none_dragonshieldios', 'none_uandi_carrer', 'none_ultra', 'oiwifi', 'olivex_titan_vpn', 'oneioo_101vpn', 'oneioo_getvpn', 'oneioo_vpnvio', 'orange', 'orionx_x2334344321342', 'pakat_lightvpn', 'panda', 'panda_VPNCorp', 'pango_july15', 'pango_june03', 'pcb_ultraflashvpn007', 'pek_secuvpn', 'ppa_trialvpn', 'privacy6', 'programmersdeck_developer', 'prt_2131232231', 'prt_greenet', 'psafe', 'psafe_dfndr_sec', 'purple_iptv_xstream', 'purple_luncher', 'qourcenext', 'rabbitvpn_bluerabitvpn', 'rabbitvpn_bluerbtvpn', 'rainnt_18323', 'readdle_sandbox', 'receh_recehVPN', 'retyu_vpn_ali5', 'rgs_sharkvpn', 'rocketvpn_rocketvpnnew', 'rocketvpn_shooravpn', 'rv_vpnmaster', 'sa_indo1', 'sa_vpnfr1234', 'samuy_vpn22', 'sasaas_cndknkdckckn', 'sbg_123test', 'sd12sd_invpn', 'sharpv_vpnprod', 'skygames_huwae', 'skygames_skyvpn', 'sl_500vpnpro', 'soft_tinysoftvpn', 'solo_zippy', 'sourcenext', 'sss_vpnproxy', 'stechtricker_vpn_break', 'str_one_vpn', 'strong_StrongrVPN1', 'super_appsx', 'taa008_androidbw', 'tcl', 'tdl_b_vpn', 'tdl_pro_vpn', 'tdl_test_app', 'tdl_vpnfpubg', 'tech01_tunnelbee', 'tech01_vpnapp', 'tech_s_com_vpn_yellow', 'tech_turbo', 'tech_vpnfree', 'techx_better_net', 'tesina_abc123', 'test12345678', 'tinysoft_tyvpn', 'touchvpn', 'trewqa_freevpn3', 'tri_bismillah', 'tri_lordvpn', 'tri_percobaan', 'trqasz_jbcjdcbdjbck', 'tst_ForDeleting', 'tst_Prjct', 'tst_QA_TEST', 'tst_deletion', 'tst_test0000011', 'tubeppiee_ultemtubepiee', 'tubeppiee_vipvpn', 'tun_active', 'tunnel_saifer', 'unifiedtnc_uniVpn', 'up0006_9876677', 'ups_test123', 'uvpn_vpn_service', 'veepee', 'vidhi_vpnserver', 'vivo', 'vk_indiavpn_fast', 'vntrs_superfreevpn', 'volfire_superclean', 'vpn123_VPNHouse', 'vpn123_Yogesh', 'vpn_bluevpn', 'vpn_fastvpn', 'vpn_mobile_app', 'vpn_snailvpn', 'vpninc_logix', 'vpnintouch', 'vpnuae_abc123', 'vufu_hcvdvcgc', 'vufu_llssgcdzs', 'vxsvpn_vxsgo', 'vxsvpn_vxsgovpn', 'wd_vpn35', 'wd_vpn44', 'werdsa_cbdhbcdhcb', 'worldvpn_cloud', 'xbshhs_pubg2_308', 'xdc_speedvpn', 'xerocr_genxvpn', 'xjssas_nsjjjcjss', 'xoxo_vpnpro', 'xpower_xpower', 'xxxxxx_66666', 'yahyat_crispvpn', 'yhtrew_canvpn3', 'youtube_dcvvpn', 'ytewqa_open1', 'zaaxx_indo2', 'zcdrty_cdhbhd', 'zxsaae_openvpn', '000077_test_aja', '0007_projectID', '001_snailvpn', '007_kingz_vpn', '007_mytry', '00_vpnone', '07_Vpn_Connect', '090903_yellovpn', '0_asdsaad', '1000_xxx11', '101101_VpnConnect', '1122_vpnddds', '114_ritzyvpn', '115537_71232', '1212_32g8hl6p0', '1212_abcdf', '1212_iqhui', '1212_ssvpn1', '122_witkey', '123456', '123456_123789', '123456_FreeVPN', '123456_Just_a_test', '123456_VPNApp', '123456_appvpn', '123456_elroi', '123456_marvelvpn', '123456_mystiqueuitests', '123456_rstudio_vpn', '123456_vpnff', '1234_vaifvpn', '123_ProjectId', '123_civpnproxy', '124488_glide_vpn', '12541_12344321', '125687_securevpnmaster', '1298_internet_vpn', '15810_BF_Browser_Ultimate', '1990_business1', '199510_comprobar_imei', '1995_wifivpn', '1_noSupport', '1_project', '2', '234_vpntest', '2_onyx1', '2_opalProject1', '3421_vpines', '42_test_vipien', '434335_vpnmaster', '460_Kingvpn', '5400_VPNDirector', '555555_artcollection', '55_headlab', '55_luckyvpn', '55_testpro', '5_27893', '610041_998899', '669947_567890', '66_rocket', '679562_booster', '786454_xxNewVPN', '786_03330008900', '91_54004', '91_fghvhgvg', '91_rapidvpnv1', '923_3089140201', 'Dini_vxsvpndini', 'LADIZETTE_vpnapp', 'MAGA_oriavpn', 'MASTERVPN_VPN101', 'MinhHoang_worldvpnpro', 'OmniNet_4174', 'OmniNet_4723', 'OmniNet_99', 'Salman_isaavpn1', 'Sparkloon_102030', 'TestProjectVPN', 'TinySoft_TinyVpn1', 'TouchVpn_touchproxy', 'TraditionalApps_onetouchvpn', 'Turbo_VPN', 'acro_test1', 'af_Bulk_project', 'af_FIRST_PROJECT', 'af_ONE_MORE_TEST_PROJECT', 'af_TEST_PROJECT', 'af_TEST_PROJECT234234', 'af_bulk_add_users_2', 'af_foshan', 'af_massuploadproject', 'af_one_more_test_projects', 'af_test_project_users', 'af_zeoal', 'af_zxczxczxc', 'afree_aaaaaaaaaaaaaaaaaaaaaaaaaa', 'afree_asdasdasdsa', 'afree_second_project', 'aft_asjdkasjd', 'aft_auto1', 'aft_auto2', 'aft_cat_test', 'aft_comcast', 'aft_december1', 'aft_june10', 'aft_multiple', 'aft_november20', 'aft_test_1', 'aft_uidproject', 'alsi_000001', 'alsi_20200728', 'alsi_D3XQqqS6f', 'alsi_PUNapY78y', 'alsi_YyEfVMWct', 'alsi_ismcloudone', 'alsi_project010', 'alsi_projectuserdelete3', 'alsi_projectuserdelete4', 'alsi_samplecompany', 'alsi_samplecompany2', 'alsi_support01', 'alsi_test_activation', 'alsi_useraddtest0109', 'apfdev_app1919', 'appfunvpn', 'aqwzsx_turbo', 'babamobilecare_BabaSuperVPN', 'better_BetterDemo', 'bhatti_bonitovpn', 'carrier_id', 'cnash1_VPN_auth', 'demo_project', 'droid_proxy', 'foundation_turbovpnelite', 'gdb', 'hubvpn', 'jJtTark_supervpn', 'kdv_testapp', 'khan_unlimitedfreevpn', 'king_sparkvpn', 'ktk_vip_app', 'mcafee_vz_demo', 'msa_smartvpn', 'mx_fastumvpn', 'no_12345', 'none_pakatprivate', 'none_pakatvpn', 'pcb_ultraflashvpn', 'prt_greennet', 'qwi_privatevpntest', 'qwi_publicvpntest', 'qwi_vpnpublic', 'rp0956_ultimatevpn', 'samuy_1234411', 'sbg_test1234', 'scripto_VPN', 'stkt_ktvpn', 'str_vpn_extra', 'volfire_supercleaner', 'vxsvpn_vxsvpn', 'xxxxxx_12345', '051_raccoonvpn']
# carriers = ('vpnintouch',)

carriers = list(set(carriers) - set(['vpnintouch']))

with DAG(
        dag_id="move_data",
        max_active_runs=1,
        dagrun_timeout=timedelta(hours=24),
        start_date=datetime(2020, 8, 31),
        # start_date=datetime.now(),
        schedule_interval="@daily"
) as dag:
    table_name = 'airflow.daily_limits'


    def get_all_carriers():
        sql = """
        with pr as (
            SELECT replace(table_id, 'device_', '') as table_id
            FROM partner_prod.__TABLES__
            WHERE starts_with(table_id, 'device_')
        
            union all
        
            SELECT replace(table_id, 'limits_', '') as table_id
            FROM partner_prod.__TABLES__
            WHERE starts_with(table_id, 'limits_')
            union all
        
            SELECT replace(table_id, 'user_', '') as table_id
            FROM partner_prod.__TABLES__
            WHERE starts_with(table_id, 'user_')
            union all
        
            SELECT replace(table_id, 'vpn_session_', '') as table_id
            FROM partner_prod.__TABLES__
            WHERE starts_with(table_id, 'vpn_session_')
        )
        select table_id
        from pr
        group by table_id
        """
        hook = BigQueryHook(bigquery_conn_id="bigquery_default", use_legacy_sql=False)

        connection = hook.get_conn()
        cursor = connection.cursor()
        cursor.execute(sql)

        carriers = []
        for row in cursor.fetchall():
            carriers.extend(row)

        print(carriers)

        # job_id = cursor.run_query(
        #     sql=self.sql,
        #     destination_dataset_table=self.destination_dataset_table,
        #     write_disposition=self.write_disposition,
        #     allow_large_results=self.allow_large_results,
        #     flatten_results=self.flatten_results,
        #     udf_config=None,
        #     maximum_billing_tier=self.maximum_billing_tier,
        #     maximum_bytes_billed=self.maximum_bytes_billed,
        #     create_disposition=self.create_disposition,
        #     query_params=self.query_params,
        #     labels=self.labels,
        #     schema_update_options=self.schema_update_options,
        #     priority=self.priority,
        #     time_partitioning=self.time_partitioning,
        #     api_resource_configs=self.api_resource_configs,
        #     cluster_fields=self.cluster_fields,
        #     encryption_configuration=self.encryption_configuration
        # )

        return carriers
    
    all_carriers = PythonOperator(
        task_id='get_all_carriers',
        python_callable=get_all_carriers,
        dag=dag,
    )

    for carrier in carriers:
        daily_limits = BigQueryOperator(
            destination_dataset_table="airflow.daily_limits_{{params.carrier}}",
            task_id=f"daily_limits_{carrier}",
            sql="sql/daily_limits.sql",
            bigquery_conn_id="bigquery_default",
            use_legacy_sql=False,
            write_disposition='WRITE_APPEND',
            create_disposition='CREATE_IF_NEEDED',
            time_partitioning={
                "field": "ptn_date",
                "type": "DAY"
            },
            allow_large_results=True,
            params={
                'carrier': carrier
            }
        )

        # daily_report = BigQueryOperator(
        #     destination_dataset_table="airflow.daily_report_{{params.carrier}}",
        #     task_id=f"daily_report_{carrier}",
        #     sql="sql/daily_report.sql",
        #     bigquery_conn_id="bigquery_default",
        #     use_legacy_sql=False,
        #     write_disposition='WRITE_APPEND',
        #     create_disposition='CREATE_IF_NEEDED',
        #     time_partitioning={
        #         "field": "ptn_date",
        #         "type": "DAY"
        #     },
        #     allow_large_results=True,
        #     params={
        #         'carrier': carrier
        #     }
        # )
        # daily_report.set_upstream(daily_limits)

